<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Imposter Game</title>

<style>
body {
    background-color: #121212;
    color: #eee;
    font-family: Arial, sans-serif;
    margin: 0;
}
h1 { text-align: center; margin-top: 20px; font-size: 28px; }

button {
    background-color: #1e1e1e;
    color: white;
    border: none;
    padding: 14px;
    margin: 8px;
    border-radius: 12px;
    font-size: 20px;
    width: 80%;
    cursor: pointer;
}
button.green { background-color: #4CAF50; }
button.gray { background-color: #2a2a2a; }

input, select {
    padding: 12px;
    font-size: 18px;
    width: 70%;
    margin-bottom: 12px;
}

.screen { display: none; }
.screen.active { display: flex; flex-direction: column; align-items: center; }

.container { padding: 20px; text-align:center; }

.toggle-btn { width: 80%; }

#homeButton {
    position: fixed;
    top: 10px;
    right: 10px;
    padding: 8px 16px;
    font-size: 16px;
    border-radius: 8px;
    background-color:#4CAF50;
    width: auto;
}

#roleOverlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

#roleCard {
    background-color: #1e1e1e;
    padding: 40px;
    border-radius: 20px;
}

#roleCard h2 { font-size: 48px; }
#roleCard pre { font-size: 30px; white-space: pre-wrap; }

#starterText { font-size:36px; color:#4CAF50; }
#turnInfo { font-size: 16px; color:#ccc; }
</style>
</head>

<body>
<div class="container">

<h1>Imposter Game</h1>
<button id="homeButton">üè† Home</button>
<div id="turnInfo"></div>

<!-- SETUP -->
<div id="setup" class="screen active">

<input type="text" id="playerName" placeholder="Player name">
<button id="addPlayerBtn">Add Player</button>
<div id="players"></div>

<label>Number of Imposters</label>
<input type="number" id="imposterCount" min="1" value="1" style="width:90px;text-align:center;">

<label>Choose Topic</label>
<select id="topicSelect"></select>

<button id="startGameBtn" class="green">START GAME</button>

<button id="topicToggle" class="toggle-btn green">Show Topic to Players: ON</button>
<button id="hintToggle" class="toggle-btn green">Imposter sees Hint: ON</button>

</div>

<!-- STARTER -->
<div id="starterScreen" class="screen">
    <h2>All players have seen their roles</h2>
    <h2 id="starterText"></h2>
</div>

<!-- ROLE -->
<div id="roleOverlay">
    <div id="roleCard">
        <h2 id="roleTitle"></h2>
        <pre id="roleText"></pre>
        <button id="doneRoleBtn" class="green">DONE (PASS PHONE)</button>
    </div>
</div>

</div>

<script>
// ------------------------
// TOPICS
// ------------------------
const defaultTopics = {
  "Places": {
    "School": "Books",
    "Airport": "Waiting",
    "Hospital": "Bright lights",
    "Beach": "Bare feet",
    "Mall": "Crowds",
    "Gym": "Sweat",
    "Library": "Whispers",
    "Office": "Schedules",
    "Restaurant": "Menus",
    "Park": "Benches",
    "Theater": "Darkness",
    "Stadium": "Echoes"
  },

  "Animals": {
    "Dog": "Leash",
    "Cat": "Silence",
    "Elephant": "Memory",
    "Lion": "Territory",
    "Penguin": "Waddle",
    "Shark": "Movement",
    "Horse": "Rhythm",
    "Bird": "Height",
    "Snake": "Stillness",
    "Crab": "Sideways",
    "Ant": "March",
    "Bee": "Buzz",
    "Butterfly": "Flutter",
    "Squirrel": "Scurry"
  },

  "Food": {
    "Pizza": "Grease",
    "Burger": "Hands",
    "Sushi": "Precision",
    "Tacos": "Messy",
    "Pasta": "Twisting",
    "Ice Cream": "Dripping",
    "Steak": "Cut",
    "Soup": "Steam",
    "Sausage": "Link",
    "Cereal": "Milk",
    "Smoothie": "Blend"
  },

  "Objects": {
    "Phone": "Vibration",
    "Laptop": "Keys",
    "Backpack": "Weight",
    "Watch": "Glance",
    "Headphones": "Isolation",
    "Bottle": "Cap",
    "Cup": "Sip",
    "Phone Charger": "Cord",
    "Umbrella": "Rain",
    "Shoes": "Step",
    "Hat": "Shade",
    "Clock": "Tick",
    "TV": "Screen"
  },

  "Jobs": {
    "Teacher": "Repetition",
    "Doctor": "Late nights",
    "Engineer": "Diagrams",
    "Chef": "Timing",
    "Firefighter": "Heat",
    "Programmer": "Debugging",
    "Artist": "Blank space",
    "Farmer": "Harvest",
    "Baker": "Oven",
    "Soldier": "March",
    "Scientist": "Lab",
    "Barista": "Steam",
    "Driver": "Wheel",
    "Lawyer": "Arguments",
    "Designer": "Sketch"
  },

  "Movies": {
    "Titanic": "Cold",
    "Inception": "Layers",
    "Star Wars": "Legacy",
    "Jurassic Park": "Containment",
    "Coco": "Memory",
    "Finding Nemo": "Journey",
    "Incredibles": "Family",
    "Shrek": "Swamp",
    "Avatar": "Blue",
    "Titan": "Fall",
    "Hobbit": "Journey",
    "Harry Potter": "Magic",
    "Moana": "Ocean",
    "Black Panther": "Kingdom",
    "Soul": "Music",
    "Zootopia": "Animals"
  },

  "Video Games": {
    "Minecraft": "Blocks",
    "Fortnite": "Circles",
    "Among Us": "Silence",
    "Zelda": "Puzzles",
    "Call of Duty": "Reflexes",
    "Pokemon": "Collection",
    "Skyrim": "Wandering",
    "Mario Kart": "Momentum",
    "Dark Souls": "Patience",
    "Candy Crush": "Matching",
    "Among Trees": "Survival",
    "Terraria": "Mining",
    "Subnautica": "Diving",
    "Dead Cells": "Rolling"
  },

  "Fruits": {
    "Apple": "Crunch",
    "Banana": "Peel",
    "Orange": "Segments",
    "Strawberry": "Seeds",
    "Mango": "Juice",
    "Grapes": "Clusters",
    "Fig": "Soft",
    "Coconut": "Hard shell",
    "Grapefruit": "Bitter",
    "Dragonfruit": "Spiky"
  },
  "Clash Royale Cards": {
  "Hog Rider": "4",
  "Mega Knight": "Arrival",
  "Princess": "Legendary",
  "Goblin Barrel": "Epic",
  "Electro Wizard": "Two",
  "Valkyrie": "Baddie",
  "P.E.K.K.A": "Heavy",
  "Mini P.E.K.K.A": "Quick",
  "Skeleton Army": "Many",
  "Balloon": "5",
  "Lava Hound": "Large",
  "Baby Dragon": "Flight",
  "Inferno Tower": "Rare",
  "Inferno Dragon": "4",
  "Royal Giant": "Range",
  "Knight": "Common",
  "Ice Spirit": "Stun",
  "Fireball": "Area Damage",
  "Zap": "Instant",
  "Log": "Legendary",
  "Miner": "Baddie",
  "Graveyard": "Many",
  "X-Bow": "Epic",
  "Mortar": "Common",
  "Elite Barbarians": "Fucking gay restards"
    },

    "Random": {
  "Burt": "M&M",
  "Low Taper Fade": "Massive",
  "Yellas": "Horable",
  "Diff EQ": "Dropped Out",
  "Joe": "Mama",
  "Nihkil": "Smells",
  "Caden": "Wise",
  "Bagles On The Hudson": "Jordan",
    },
    "Slurs": {
  "Nigga": "Kobe",
  "Nigger": "Meaningless",
  "Faggot": "David",
  "Cracker": "White",
  "Jews": "10% Off",
  "Arabs": "7/11",
  "Adolf": "Germans",
  "Retard": "Caden",
    },

  "Activities": {
    "Driving": "Focus",
    "Cooking": "Timing",
    "Reading": "Immersion",
    "Gaming": "Engagement",
    "Exercising": "Breath",
    "Studying": "Repetition",
    "Shopping": "Choices",
    "Jogging": "Steps",
    "Meditating": "Stillness",
    "Photography": "Framing",
    "Traveling": "Luggage",
    "Yoga": "Stretch",
    "Camping": "Fire",
    "Cycling": "Pedal",
    "Skateboarding": "Ramp",
    "Surfing": "Wave"

  }
};
let topics = JSON.parse(localStorage.getItem("imposterTopics")) || defaultTopics;

// ------------------------
// STATE
// ------------------------
let players = [];
let roles = {};
let viewed = [];
let currentTopic="", currentWord="", currentHint="";
let showTopic = true;
let showHint = true;
let currentPlayer="";

// ------------------------
// DOM
// ------------------------
const playersDiv = document.getElementById("players");
const topicSelect = document.getElementById("topicSelect");
const topicToggle = document.getElementById("topicToggle");
const hintToggle = document.getElementById("hintToggle");

// ------------------------
// POPULATE TOPICS
// ------------------------
topicSelect.innerHTML = `<option value="RANDOM">üé≤ Random Topic</option>`;
Object.keys(topics).forEach(t=>{
    const o=document.createElement("option");
    o.value=t; o.textContent=t;
    topicSelect.appendChild(o);
});

// ------------------------
// TOGGLES
// ------------------------
topicToggle.onclick = ()=>{
    showTopic=!showTopic;
    topicToggle.textContent=`Show Topic to Players: ${showTopic?"ON":"OFF"}`;
    topicToggle.className=`toggle-btn ${showTopic?"green":"gray"}`;
};

hintToggle.onclick = ()=>{
    showHint=!showHint;
    hintToggle.textContent=`Imposter sees Hint: ${showHint?"ON":"OFF"}`;
    hintToggle.className=`toggle-btn ${showHint?"green":"gray"}`;
};

// ------------------------
// PLAYERS
// ------------------------
function renderPlayers(){
    playersDiv.innerHTML="";
    players.forEach(p=>{
        const row=document.createElement("div");
        row.style.display="flex";
        row.style.width="90%";
        row.style.margin="6px auto";

        const btn=document.createElement("button");
        btn.style.flex="1";
        btn.textContent=p+(viewed.includes(p)?" ‚úî":"");
        btn.onclick=()=>showRoleForPlayer(p);

        const del=document.createElement("button");
        del.textContent="‚ùå";
        del.style.width="50px";
        del.style.background="#aa3333";
        del.onclick=e=>{
            e.stopPropagation();
            players=players.filter(x=>x!==p);
            viewed=viewed.filter(x=>x!==p);
            renderPlayers();
        };

        row.append(btn,del);
        playersDiv.appendChild(row);
    });
    document.getElementById('turnInfo').textContent=`Players done: ${viewed.length}/${players.length}`;
}

addPlayerBtn.onclick=()=>{
    const n=playerName.value.trim();
    if(n&&!players.includes(n)){
        players.push(n);
        playerName.value="";
        renderPlayers();
    }
};

playerName.onkeypress=e=>{
    if(e.key==="Enter") addPlayerBtn.click();
};

// ------------------------
// FAIR IMPOSTER SELECTION
// ------------------------
function pickLeastPicked(players, imposterCount, trials = 3){
    const pickCounts = {};
    players.forEach(p=>pickCounts[p]=0);

    for(let t=0; t<trials; t++){
        const shuffled = [...players];
        for(let i=shuffled.length-1;i>0;i--){
            const j=Math.floor(Math.random()*(i+1));
            [shuffled[i], shuffled[j]]=[shuffled[j], shuffled[i]];
        }
        for(let i=0;i<imposterCount;i++) pickCounts[shuffled[i]]++;
    }

    // Pick the 'imposterCount' with the lowest pick counts, preserving original order
    const sortedByCount = [...players].sort((a,b)=>pickCounts[a]-pickCounts[b]);
    const leastPickedSet = new Set(sortedByCount.slice(0, imposterCount));

    // Preserve original order
    const impostersInOrder = new Set();
    players.forEach(p=>{ if(leastPickedSet.has(p)) impostersInOrder.add(p); });
    return impostersInOrder;
}

// ------------------------
// START GAME
// ------------------------
startGameBtn.onclick = ()=>{
    if(players.length<3){ alert("Need at least 3 players"); return; }

    let imposterCount = parseInt(document.getElementById('imposterCount').value,10);
    if(isNaN(imposterCount)||imposterCount<1){ alert("Invalid imposter count"); return; }
    if(imposterCount>=players.length){ alert("Imposters must be fewer than players"); return; }

    // Pick topic + word
    const topicKeys = Object.keys(topics);
    currentTopic = topicKeys[Math.floor(Math.random()*topicKeys.length)];
    const words = Object.entries(topics[currentTopic]);
    [currentWord,currentHint] = words[Math.floor(Math.random()*words.length)];

    const imposters = pickLeastPicked(players, imposterCount, 3);

    // Assign roles
    roles = {};
    players.forEach(p=>roles[p] = imposters.has(p)?"IMPOSTER":"CREWMATE");

    viewed=[]; currentPlayer="";
    renderPlayers();
    alert("Game ready! Pass the phone.");
};

// ------------------------
// ROLE VIEW
// ------------------------
function showRoleForPlayer(name){
    currentPlayer=name;
    const r=roles[name];
    let t=r==="IMPOSTER"?"YOU ARE THE IMPOSTER":"YOU ARE A CREWMATE";
    if(showTopic) t+=`\n\nTopic: ${currentTopic}`;
    if(r==="CREWMATE") t+=`\nWord: ${currentWord}`;
    if(r==="IMPOSTER"&&showHint) t+=`\nHint: ${currentHint}`;
    roleTitle.textContent=name;
    roleText.textContent=t;
    roleOverlay.style.display="flex";
}

doneRoleBtn.onclick=()=>{
    viewed.push(currentPlayer);
    roleOverlay.style.display="none";
    renderPlayers();
    if(viewed.length===players.length){
        starterText.textContent=`${players[Math.floor(Math.random()*players.length)]} GOES FIRST üî•`;
        setup.classList.remove("active");
        starterScreen.classList.add("active");
    }
};

homeButton.onclick=()=>{
    starterScreen.classList.remove("active");
    setup.classList.add("active");
};
</script>
</body>
</html>
