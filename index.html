<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Imposter Game</title>
<style>
body {
    background-color: #121212;
    color: #eee;
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
}
h1 { margin-top: 20px; font-size: 28px; text-align: center; }
button {
    background-color: #1e1e1e;
    color: white;
    border: none;
    padding: 16px;
    margin: 8px;
    border-radius: 12px;
    font-size: 20px;
    width: 80%;
    cursor: pointer;
}
button.green { background-color: #4CAF50; }
button.gray { background-color: #2a2a2a; }
input {
    padding: 12px;
    font-size: 20px;
    width: 70%;
    margin-bottom: 12px;
}
#players button { width: 90%; cursor: pointer; font-size: 20px; padding: 14px; }
.screen { display: none; height: 80vh; }
.screen.active { display: flex; flex-direction: column; justify-content: center; align-items: center; }
.container { padding: 20px; }
.toggle-btn { width: 80%; cursor: pointer; font-size: 18px; padding: 12px; }
#homeButton {
    position: fixed;
    top: 10px;
    right: 10px;
    width: auto;
    padding: 10px 16px;
    font-size: 16px;
    border-radius: 8px;
    background-color:#4CAF50;
    cursor: pointer;
}
#turnInfo { margin-top: 12px; font-size: 16px; color:#ccc; text-align:center; }

#roleScreen, #revealScreen, #starterScreen {
    display:flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: calc(100vh - 40px);
}
#roleTitle, #revealName { font-size: 36px; text-align:center; margin-bottom: 20px; }
#roleText { font-size: 28px; white-space: pre-wrap; text-align: center; margin-bottom: 30px; }

#starterScreen h2 { font-size: 32px; margin: 10px 0; text-align:center; }
#starterText { font-size: 36px; margin-top: 20px; color: #4CAF50; text-align:center; }
</style>
</head>
<body>

<div class="container">

<h1>Imposter Game</h1>

<button id="homeButton">üè† Home</button>
<div id="turnInfo"></div>

<!-- SETUP SCREEN -->
<div id="setup" class="screen active">
    <input type="text" id="playerName" placeholder="Player name">
    <button id="addPlayerBtn">Add Player</button>
    <div id="players"></div>
    <button id="startGameBtn" class="green">START GAME</button>

    <div style="margin-top:20px;">
        <button id="topicToggle" class="toggle-btn green">Show Topic to Players: ON</button><br>
        <button id="hintToggle" class="toggle-btn green">Imposter sees Hint: ON</button>
    </div>
</div>

<!-- REVEAL SCREEN -->
<div id="revealScreen" class="screen">
    <h2 id="revealName"></h2>
    <p style="font-size:20px; text-align:center;">Is this you? Make sure no one else is looking üëÄ</p>
    <button id="showRoleBtn" class="green">YES ‚Äì SHOW MY ROLE</button>
    <button id="backToPlayersBtn" class="gray">NO ‚Äì GO BACK</button>
</div>

<!-- ROLE SCREEN -->
<div id="roleScreen" class="screen">
    <h2 id="roleTitle"></h2>
    <pre id="roleText"></pre>
    <button id="doneRoleBtn" class="green">DONE (PASS PHONE)</button>
</div>

<!-- STARTER SCREEN -->
<div id="starterScreen" class="screen">
    <h2>All players have seen their roles</h2>
    <h2 id="starterText"></h2>
</div>

</div>

<script>
document.addEventListener("DOMContentLoaded", function() {

    // ------------------------
    // Topics
    // ------------------------
    const defaultTopics = {
      "Places": {"School":"Books","Airport":"Waiting","Hospital":"Bright lights","Beach":"Bare feet","Mall":"Crowds"},
      "Animals": {"Dog":"Leash","Cat":"Silence","Elephant":"Memory","Lion":"Territory","Penguin":"Waddle"},
      "Food": {"Pizza":"Grease","Burger":"Hands","Sushi":"Precision","Tacos":"Messy","Pasta":"Twisting"}
    };
    let topics = JSON.parse(localStorage.getItem("imposterTopics")) || defaultTopics;

    // ------------------------
    // Game State
    // ------------------------
    let players = [];
    let roles = {};
    let viewed = [];
    let currentTopic = "";
    let currentWord = "";
    let currentHint = "";
    let starterPlayer = "";
    let showTopic = true;
    let showHint = true;
    let currentPlayer = "";

    // ------------------------
    // Helper: Switch Screen
    // ------------------------
    function switchScreen(from,to){
        if(from) document.getElementById(from).classList.remove('active');
        if(to) document.getElementById(to).classList.add('active');
        updateTurnInfo();
    }

    // ------------------------
    // Player Management
    // ------------------------
    function renderPlayers(){
        const playersDiv = document.getElementById('players');
        playersDiv.innerHTML = "";
        players.forEach(p=>{
            const btn = document.createElement('button');
            btn.textContent = p + (viewed.includes(p) ? " ‚úî" : "");
            btn.addEventListener('click',()=>confirmPlayer(p));
            playersDiv.appendChild(btn);
        });
        updateTurnInfo();
    }

    function addPlayer(){
        const nameInput = document.getElementById('playerName');
        const name = nameInput.value.trim();
        if(name && !players.includes(name)){
            players.push(name);
            nameInput.value="";
            renderPlayers();
        }
    }

    document.getElementById('addPlayerBtn').addEventListener('click', addPlayer);
    document.getElementById('playerName').addEventListener('keypress', function(e){
        if(e.key === "Enter"){ addPlayer(); }
    });

    // ------------------------
    // Toggle Options
    // ------------------------
    document.getElementById('topicToggle').addEventListener('click',()=>{
        showTopic = !showTopic;
        const btn=document.getElementById('topicToggle');
        btn.textContent = `Show Topic to Players: ${showTopic?"ON":"OFF"}`;
        btn.className = showTopic?"toggle-btn green":"toggle-btn gray";
    });
    document.getElementById('hintToggle').addEventListener('click',()=>{
        showHint = !showHint;
        const btn=document.getElementById('hintToggle');
        btn.textContent = `Imposter sees Hint: ${showHint?"ON":"OFF"}`;
        btn.className = showHint?"toggle-btn green":"toggle-btn gray";
    });

    // ------------------------
    // Game Logic
    // ------------------------
    document.getElementById('startGameBtn').addEventListener('click',()=>{
        if(players.length<3){ alert("Need at least 3 players"); return; }
        const topicKeys = Object.keys(topics);
        currentTopic = topicKeys[Math.floor(Math.random()*topicKeys.length)];
        const words = Object.entries(topics[currentTopic]);
        [currentWord,currentHint]=words[Math.floor(Math.random()*words.length)];

        const imposters = new Set();
        while(imposters.size<1){
            imposters.add(players[Math.floor(Math.random()*players.length)]);
        }
        roles = {};
        players.forEach(p=>roles[p]=imposters.has(p)?"IMPOSTER":"CREWMATE");
        viewed=[]; currentPlayer="";
        renderPlayers();
        alert("Game ready! Pass the phone. Tap your name to see your role.");
    });

    // ------------------------
    // Player/Role Flow
    // ------------------------
    function confirmPlayer(name){
        currentPlayer=name;
        document.getElementById('revealName').textContent=name;
        switchScreen('setup','revealScreen');
    }

    document.getElementById('backToPlayersBtn').addEventListener('click',()=>switchScreen('revealScreen','setup'));

    document.getElementById('showRoleBtn').addEventListener('click',()=>{
        const role=roles[currentPlayer];
        let text=role==="IMPOSTER"?"YOU ARE THE IMPOSTER\n":"YOU ARE A CREWMATE\n";
        if(role==="IMPOSTER"){
            if(showTopic) text+=`\nTopic: ${currentTopic}`;
            if(showHint) text+=`\nHint: ${currentHint}`;
            if(!showTopic&&!showHint) text+="\nNo extra info. Blend in üòà";
        } else {
            if(showTopic) text+=`\nTopic: ${currentTopic}`;
            text+=`\nWord: ${currentWord}`;
        }
        document.getElementById('roleTitle').textContent=currentPlayer;
        document.getElementById('roleText').textContent=text;
        switchScreen('revealScreen','roleScreen');
    });

    document.getElementById('doneRoleBtn').addEventListener('click',()=>{
        viewed.push(currentPlayer);
        renderPlayers();
        if(viewed.length===players.length){
            starterPlayer = players[Math.floor(Math.random()*players.length)];
            document.getElementById('starterText').textContent=`${starterPlayer} GOES FIRST üî•`;
            switchScreen('roleScreen','starterScreen');
        } else {
            switchScreen('roleScreen','setup');
        }
    });

    // ------------------------
    // Home Button
    // ------------------------
    document.getElementById('homeButton').addEventListener('click',()=>switchScreen(null,'setup'));

    // ------------------------
    // Turn Info
    // ------------------------
    function updateTurnInfo(){
        const div = document.getElementById('turnInfo');
        div.textContent=`Players done: ${viewed.length}/${players.length}`;
    }

});
</script>

</body>
</html>
